<!DOCTYPE html>
<html lang="en">
	<head>
		<base href="https://cdn.jsdelivr.net/gh/genizy/google-class@main/a-game-black-hole/">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
		<title>A Game About Feeding A Black Hole</title>
		<style>
html, body, #canvas {
	margin: 0;
	padding: 0;
	border: 0;
}

body {
	color: white;
	background-color: black;
	overflow: hidden;
	touch-action: none;
}

#canvas {
	display: block;
}

#canvas:focus {
	outline: none;
}

#status, #status-splash, #status-progress {
	position: absolute;
	left: 0;
	right: 0;
}

#status, #status-splash {
	top: 0;
	bottom: 0;
}

#status {
	background-color: #525254;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	visibility: hidden;
}

#status-splash {
	max-height: 100%;
	max-width: 100%;
	margin: auto;
}

#status-splash.show-image--false {
	display: none;
}

#status-splash.fullsize--true {
	height: 100%;
	width: 100%;
	object-fit: contain;
}

#status-splash.use-filter--false {
	image-rendering: pixelated;
}

#status-progress, #status-notice {
	display: none;
}

#status-progress {
	bottom: 10%;
	width: 50%;
	margin: 0 auto;
}

#status-notice {
	background-color: #5b3943;
	border-radius: 0.5rem;
	border: 1px solid #9b3943;
	color: #e0e0e0;
	font-family: 'Noto Sans', 'Droid Sans', Arial, sans-serif;
	line-height: 1.3;
	margin: 0 2rem;
	overflow: hidden;
	padding: 1rem;
	text-align: center;
	z-index: 1;
}

#loading-text {
  font-weight: bold;
  background: linear-gradient(
    270deg,
    #ff0000,
    #ff7f00,
    #ffff00,
    #00ff00,
    #0000ff,
    #4b0082,
    #8f00ff
  );
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 3s ease infinite;
}

@keyframes rainbow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
		</style>
		<link id="-gd-engine-icon" rel="icon" type="image/png" href="index.icon.png" />
<link rel="apple-touch-icon" href="index.apple-touch-icon.png"/>

	</head>
	<body>
		<div id="loading-text"
    style="color: white; font-size: 48px; font-family: cursive; text-align: center; margin-top: 20px;"> LOADING...
  </div>
		<canvas id="canvas">
			Your browser does not support the canvas tag.
		</canvas>

		<noscript>
			Your browser does not support JavaScript.
		</noscript>

		<div id="status">
			<img id="status-splash" class="show-image--false fullsize--true use-filter--true" src="index.png" alt="">
			<progress id="status-progress"></progress>
			<div id="status-notice"></div>
		</div>

		<script src="index.js"></script>
		<script src="main.js"></script>
		<script>
(function() {
	var loadingText = document.querySelector("#loading-text");
    'use strict';

    const originalFetch = window.fetch;
    const mergedData = {}; 
    const pendingRequests = {}; 

    window.fetch = function(url, ...args) {
        const urlString = url.toString();
        
        if (urlString.endsWith("index.pck") || urlString.endsWith("index.wasm")) {

            if (mergedData[urlString]) {
                return Promise.resolve(new Response(mergedData[urlString]));
            }

            return new Promise((resolve) => {
                if (!pendingRequests[urlString]) pendingRequests[urlString] = [];
                pendingRequests[urlString].push(resolve);
            });
        }
        return originalFetch(url, ...args);
    };

    async function mergeFiles(baseFileName, start, end) {
        const buffers = [];
        console.log(`[Merger] Starting merge for ${baseFileName}...`);

        try {
            for (let i = start; i <= end; i++) {
                const partName = `${baseFileName}.part${i}`;
                const response = await originalFetch(partName);
                
                if (!response.ok) throw new Error(`Part ${i} missing for ${baseFileName}`);
                
                const data = await response.arrayBuffer();
                buffers.push(data);
				loadingText.textContent = "LOADING... ("+i+"/9)";
                console.log(`[Merger] Loaded ${partName}`);
            }

            const mergedBlob = new Blob(buffers, { type: 'application/octet-stream' });
            mergedData[baseFileName] = mergedBlob;

            if (pendingRequests[baseFileName]) {
                pendingRequests[baseFileName].forEach(resolve => {
                    resolve(new Response(mergedBlob));
                });
                delete pendingRequests[baseFileName];
            }

            return mergedBlob;
        } catch (err) {
            console.error(`[Merger] Failed to merge ${baseFileName}:`, err);
        }
    }

    async function init() {
        await Promise.all([
            mergeFiles("index.pck", 1, 7),
            mergeFiles("index.wasm", 1, 2)
        ]);

        console.log("[Merger] All files ready. Starting Godot...");
        if (typeof window.godotRunStart === 'function') {
			loadingText.remove();
            window.godotRunStart();
        }
    }

    init();
})();
		</script>
	</body>
</html>
